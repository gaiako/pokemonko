$("#search-c").keypress(function(a){13==a.which&&$("#btn-search-c").click()});$("#search-p").keypress(function(a){13==a.which&&$("#btn-search-p").click()});var request=function(a,b,c,e){void 0==b&&(b={});b.cmd=a;$.post("/php/get/__admin_get.php",b,function(a){a=JSON.parse(a);void 0!=a.success&&1==a.success?c(a.data):(void 0!=e&&e(a.message),alert(a.message))})};request("get_min_val_atacado",{},function(a){void 0==a.error?sessionStorage.setItem("min_valor_atacado",a.valor):alert(a.error)});
var display=function(a,b){void 0===b&&(b=!0);a.css("display",b?"block":"none")},disable=function(a,b){void 0===b&&(b=!0);a.prop("disabled",b).css("pointerEvents",b?"none":"auto")},loading=function(a,b,c){disable(b,a);c.css("display",a?"inline-block":"none")},order={client:{get:function(){return $("#list-c").val()},displaySearchBox:function(){display($("#div-search-c"));display($("#div-list-c"),!1)},displayListBox:function(){display($("#div-list-c"));display($("#div-search-c"),!1)},displayInfo:function(a){null!=
a&&($("#cli-nome").text(a.nome),$("#cli-email").text(a.email),$("#cli-creditos").text(a.creditos),this.phone.list(a.telefones));display($("#tbl-c"),null!=a)},getSearchText:function(){return $("#search-c").val()},clearSearchText:function(){$("#search-c").val("")},fillList:function(a){for(var b=0;b<a.length;++b)$("#list-c").append('<option value="'+a[b].id+'">'+a[b].nome+"("+a[b].email+")</option>");$("#list-c").prop("selectedIndex",-1)},clearList:function(){$("#list-c").empty().prop("disabled",!1)},
clear:function(){this.clearList();this.clearSearchText();this.displayInfo(null);this.displaySearchBox();this.address.clear()},lockSearch:function(){loading(!0,$("#search-c, #btn-search-c"),$("#loading-c"))},unlockSearch:function(){loading(!1,$("#search-c, #btn-search-c"),$("#loading-c"))},doSearch:function(){var a=this.getSearchText();if(null==a||""==a)return alert("Preencha o campo de busca!"),!1;this.lockSearch();request("find_client",{name:a},function(a){this.unlockSearch();this.displayListBox();
this.fillList(a)}.bind(this),this.unlockSearch.bind(this))},lockSelect:function(){loading(!0,$("#list-c, #btn-new-search-c"),$("#loading-c2"))},unlockSelect:function(){loading(!1,$("#list-c, #btn-new-search-c"),$("#loading-c2"))},selectClient:function(){this.lockSelect();var a=$("#list-c");request("get_client",{id:a.val()},function(b){this.unlockSelect();this.displayInfo(b);a.prop("disabled",!0);this.address.list(b.enderecos)}.bind(this),this.unlockSelect.bind(this))},register:function(){$("#btn-search-c").unbind().click(this.doSearch.bind(this));
$("#list-c").unbind().change(this.selectClient.bind(this));$("#btn-new-search-c").unbind().click(this.clear.bind(this));this.address.register();this.phone.register()},address:{get:function(){return $("#list-e").val()},list:function(a,b){if(void 0!=a){var c=$("#list-e");c.empty();for(var e=0;e<a.length;++e){var f=a[e];c.append("<option "+(f.id==b?'selected="selected" ':"")+'value="'+f.id+'">'+(f.endereco+", n\u00b0 "+f.numero+" - "+f.bairro.bairro+", "+f.bairro.cidade.cidade+", "+f.bairro.cidade.estado.estado+
" - "+f.cep)+"</option>")}0>=b&&c.prop("selectedIndex",-1);$("#list-e").prop("disabled",!1);$("#add-endereco").prop("disabled",!1)}},clear:function(){$("#list-e").empty().prop("disabled",!0);$("#add-endereco").prop("disabled",!0);display($("#display-frete"),!1);this.clearNewAddress()},clearNewAddress:function(){display($("#new-endereco"),!1);$("#cep").val("");$("#estado").prop("selectedIndex",-1);$("#cidade").empty();$("#bairro").empty();$("#endereco").val("");$("#numero").val("");$("#complemento").val("")},
loadLocal:function(a,b,c,e,f){void 0===e&&(e=-1);request(a,{id:$(b).val()},function(a){var b=$(c);b.empty();for(var g=0;g<a.length;++g)b.append("<option "+(e==a[g].id?'selected="selected"':"")+' value="'+a[g].id+'">'+a[g].nome+"</option>");0>=e&&b.prop("selectedIndex",-1);void 0!=f&&f()})},displayDistrictList:function(a){void 0===a&&(a=!0);if(a)$("#nome-bairro").val("");else{if(0>=$("#cidade").val()){alert("Selecione uma cidade!");return}this.unlockAdd()}display($("#select-bairro"),a);display($("#new-bairro"),
!a);disable($("#save-endereco"),!a)},lockAdd:function(){loading(!0,$("#save-bairro, #nome-bairro"),$("#loading-sb"))},unlockAdd:function(){loading(!1,$("#save-bairro, #nome-bairro"),$("#loading-sb"))},saveDistrict:function(){var a=$("#cidade").val();if(0<a){var b=$("#nome-bairro").val();""==b?(alert("Digite o nome do bairro!"),this.unlockAdd()):(this.lockAdd(),request("save_bairro",{id:a,nome:b},function(a){var b=function(){this.unlockAdd();this.displayDistrictList()}.bind(this);void 0!=a.error?(alert(a.error),
b()):this.loadLocal("get_bairros","#cidade","#bairro",a.id,b,this.unlockAdd.bind(this))}.bind(this),this.unlockAdd.bind(this)))}else alert("Selecione uma cidade!")},loading:function(a,b){var c=b?$("#loading-se"):$("#loading-cep");loading(a,$("#complemento, #numero, #endereco, #bairro, #cidade, #estado, #cep, #search-cep, #add-bairro, #save-endereco"),c)},lock:function(a){this.loading(!0,a)},unlock:function(a){this.loading(!1,a)},loadByCep:function(){var a=$("#cep").val();""!=a&&(this.lock(!1),request("get_by_cep",
{cep:a},function(a){var c=this.unlock.bind(this);void 0!=a.eid&&($("#estado").find('option[value="'+a.eid+'"]').prop("selected",!0),this.loadCities(a.cid,function(){this.loadDistrict(a.bid,function(){$("#endereco").val(a.endereco);$("#search-cep").css("pointerEvents","auto");$("#cep").prop("disabled",!1);c()}.bind(this),c)}.bind(this),c))}.bind(this),this.unlock.bind(this,!1)))},addNew:function(){$("#new-endereco").css("display","inline-block");this.displayDistrictList()},save:function(){var a=$("#cep").val(),
b=$("#bairro").val(),c=$("#endereco").val(),e=$("#numero").val(),f=$("#complemento").val(),d=$("#list-c").val();""==a?alert("Preencha o CEP!"):0>=b?alert("Selecione o bairro!"):""==c?alert("Digite o endere\u00e7o!"):""==e?alert("Digite o n\u00famero!"):0>=d?alert("Selecione um cliente!"):(this.lock(!0),request("save_endereco",{cid:d,bid:b,endereco:c,cep:a,numero:e,complemento:f},function(a){var b=this.unlock.bind(this,!0);void 0!=a.result?0<a.result?request("get_client",{id:d},function(c){this.list(c.enderecos,
a.result);this.clearNewAddress();$("#list-e").change();b()}.bind(this),b):(alert("N\u00e3o foi possivel cadastrar o endere\u00e7o!"),b()):(alert('N\u00e3o foi possivel cadastrar o endere\u00e7o: "'+a.error+'"!'),b())}.bind(this),this.unlock.bind(this,!0)))},loadStates:function(a){this.loadLocal("get_estados","","#estado",a)},loadCities:function(a,b){this.loadLocal("get_cidades","#estado","#cidade",a,b)},loadDistrict:function(a,b){this.loadLocal("get_bairros","#cidade","#bairro",a,b)},register:function(){$("#add-bairro").unbind().click(this.displayDistrictList.bind(this,
!1));$("#cancel-bairro").unbind().click(this.displayDistrictList.bind(this));$("#save-bairro").unbind().click(this.saveDistrict.bind(this));$("#search-cep").unbind().click(this.loadByCep.bind(this));$("#add-endereco").unbind().click(this.addNew.bind(this));$("#save-endereco").unbind().click(this.save.bind(this));$("#cancel-endereco").unbind().click(this.clearNewAddress.bind(this));$("#estado").unbind().change(this.loadCities.bind(this,-1,function(){$("#bairro").empty()}));$("#cidade").unbind().change(this.loadDistrict.bind(this));
$("#cep").keyup(function(){var a=this.value,a=a.replace(/\D/g,"");this.value=a=a.replace(/^(\d{5})(\d)/,"$1-$2")});this.loadStates()}},phone:{displayList:function(a){void 0===a&&(a=!0);display($("#new-tel"),!a);display($("#select-tels"),a);a&&$("#num-tel").val("")},get:function(){return $("#cli-tels").val()},getText:function(){return $("#num-tel").val()},list:function(a){this.displayList(!0);for(var b=$("#cli-tels").empty(),c=0;c<a.length;++c)b.append("<option>"+a[c]+"</option>")},lock:function(){loading(!0,
$("#save-tel, #cancel-tel, #num-tel"),$("#loading-t"))},unlock:function(){loading(!1,$("#save-tel, #cancel-tel, #num-tel"),$("#loading-t"))},addPhone:function(){this.displayList(!1);this.unlock()},saveNumber:function(){var a=$("#list-c").val();if(0>=a)return alert("Selecione um cliente!"),!1;var b=this.getText();if(""==b)return alert("Digite o telefone!"),!1;this.lock();request("add_client_tel",{id:a,tel:b},function(a){this.unlock();void 0!=a.telefones?this.list(a.telefones):alert(a.error)}.bind(this),
this.unlock.bind(this))},register:function(){$("#add-tel").unbind().click(this.addPhone.bind(this));$("#save-tel").unbind().click(this.saveNumber.bind(this));$("#cancel-tel").unbind().click(this.displayList.bind(this));$("#num-tel").keyup(function(){var a=this.value,a=a.replace(/\D/g,"");this.value=a=10>=a.length?a.replace(/^(\d{2})(\d{0,4})(\d{0,4})/,"($1) $2-$3"):a.replace(/^(\d{2})(\d{0,5})(\d{0,4})/,"($1) $2-$3")})}}},shipping:{get:function(){return $("#tipo-frete").val()},list:function(a){for(var b=
$("#tipo-frete").empty(),c=0;c<a.length;++c)b.append('<option value="'+a[c].id+'">'+a[c].nome+"</option>");b.prop("selectedIndex",-1)},clear:function(){display($("#display-frete"),!1);$("#tipo-frete").prop("selectedIndex",-1)},loadTypes:function(){request("get_tipo_frete",{},this.list)},onTypeChange:function(){var a=function(){};3==$(this).val()?a=function(){var a=$("#list-e").val();null!=a&&""!=a&&request("get_valor_frete",{id:a},function(a){if(void 0!=a.valor){var b=!0;-1==a.valor?(alert("Frete indisponivel para este endere\u00e7o!"),
$("#list-e").prop("selectedIndex",-1),b=!1):$("#valor-frete").text(a.valor);display($("#display-frete"),b)}else alert(a.error)})}:$("#display-frete").css("display","none");a();$("#list-e").unbind("change").change(a)},register:function(){$("#tipo-frete").change(this.onTypeChange);this.loadTypes()}},product:{displaySearchBox:function(a){void 0==a&&(a=!0);display($("#div-search-p"),a);display($("#div-list-p"),!a)},lock:function(){loading(!0,$("#search-p, #filter-by-c, #filter-by-p, #btn-search-p"),$("#loading-p"))},
unlock:function(){loading(!1,$("#search-p, #filter-by-c, #filter-by-p, #btn-search-p"),$("#loading-p"))},list:function(a){for(var b=$("#list-p").empty(),c=0;c<a.length;++c)b.append('<option value="'+a[c].id+'">'+a[c].nome+"  ["+a[c].valor+"/"+a[c].valorAtacado+"  ("+a[c].qtdAtacado+")]</option>");b.prop("selectedIndex",-1);this.displaySearchBox(!1)},find:function(){var a=$("#filter-by-c").hasClass("active")?1:0;this.lock();request("product_list",{busca:$("#search-p").val(),categoria:a},function(a){this.list(a);
this.unlock()}.bind(this),this.unlock.bind(this))},clear:function(){$("#list-p").empty();$("#search-p").val("");display($("#tbl-p").empty(),!1);this.displaySearchBox()},listItems:function(a){var b=$("#tbl-p").empty();b.css("display","table");var c=!1,e=!1;0<a.itens.length&&(e=void 0!=a.itens[0].tamanho,c=void 0!=a.itens[0].cor);b.append("<tr>"+(c?'<th style="width:15%;" >Cor</th>':"")+(e?'<th style="width:40%;" >Tamanho</th>':"")+'<th >Estoque</th><th></th style="width:10%;"></tr>');for(var f=0;f<
a.itens.length;++f){var d=a.itens[f];if(0<d.estoque){var h="";if(void 0!=d.cor)if(void 0!=d.cor.foto)h='<span class="color-box" style="background-image:'+d.cor.foto+'"></span>';else for(var g=0;g<d.cor.hexadecimais.length;++g)h+='<span class="color-box" style="background-color:'+d.cor.hexadecimais[g]+'"></span>';else h="";g="";void 0!=d.tamanho&&(g=d.tamanho.tamanho);b.append("<tr>"+(c?"<td>"+h+"</td>":"")+(e?"<td>"+g+"</td>":"")+"<td>"+d.estoque+'</td><td><input type="text" class="qtd-box" name="'+
d.id+'"value="1"><span class="btn btn-p btn-add-p" data-id="'+d.id+'"><i class="icon-plus" ></i></span></td></tr>');var n=function(){var a=0,b=0,c=$("#cart-list"),e=$("#total");e.text("0.00");for(var f=c.find("tr[name]"),c=[],d=0;d<f.length;++d){var g=$(f[d]),k=Number(g.find('td[name="qtd"]').text()),l=g.find('td[name="vu"]'),g=g.find('td[name="valor"]'),h=Number(l.data("vu")),n=Number(l.data("vau")),p=h*k,k=n*k,a=a+p,b=b+k;c.push({0:h,1:n,2:p,3:k,vu:l,v:g})}f=0;l=2;d=sessionStorage.getItem("min_valor_atacado");
b>d&&0<d?(f=1,l=3,e.text(Number(b).toFixed(2))):e.text(Number(a).toFixed(2));for(d=0;d<c.length;++d)c[d].vu.text(Number(c[d][f]).toFixed(2)),c[d].v.text(Number(c[d][l]).toFixed(2))};b.find(".btn-add-p[data-id="+d.id+"]").click(function(c,d,e,f,g){return function(){var h=c.find("tr[name="+d+"]"),m=Number(b.find("input[name="+d+"]").val()),k=a.valor,l=0<a.valorAtacado&&a.valorAtacado<k?a.valorAtacado:k;if(0<h.length){k=h.find('td[name="qtd"]');m+=Number(k.text());if(m>g){alert("Quantidade inv\u00e1lida!");
return}0>=m?h.remove():k.text(m)}else{if(m>g){alert("Quantidade inv\u00e1lida!");return}c.append('<tr name="'+d+'"><td>'+e+" "+f+" "+a.nome+'</td><td name="vu" data-vu="'+k+'" data-vau="'+l+'" ></td><td name="qtd" >'+m+'</td><td name="valor" ></td><td><i class="icon-remove cart-rem" ></i></td></tr>')}n();$(".cart-rem").click(function(){$(this).parent().parent().remove();n()})}}($("#cart-list"),d.id,h,g,d.estoque))}}},lockSelect:function(){loading(!0,$("#list-p, #btn-new-search-p"),$("#loading-i"))},
unlockSelect:function(){loading(!1,$("#list-p, #btn-new-search-p"),$("#loading-i"))},loadProductItems:function(){this.lockSelect();$("#tbl-p").empty();request("product_items",{id:$("#list-p").val()},function(a){this.listItems(a);this.unlockSelect()}.bind(this),this.unlockSelect.bind(this))},filterByCategory:function(a){var b=$("#filter-by-p"),c=$("#filter-by-c");a&&(a=b,b=c,c=a);b.addClass("active");c.removeClass("active")},register:function(){$("#btn-search-p").unbind().click(this.find.bind(this));
$("#btn-new-search-p").unbind().click(this.clear.bind(this));$("#list-p").unbind().change(this.loadProductItems.bind(this));$("#filter-by-p").unbind().click(this.filterByCategory.bind(this,!1));$("#filter-by-c").unbind().click(this.filterByCategory.bind(this,!0));this.filterByCategory(!1)}},cart:{get:function(){for(var a=[],b=$("#cart-list").find("tr[name]"),c=0;c<b.length;++c){var e=$(b[c]),f=e.attr("name"),e=Number(e.find('td[name="qtd"]').text());a.push({id:f,qtd:e})}return a},getSubTotal:function(){return Number($("#total").text())},
clear:function(){$("#cart-list tr[name]").remove();$("#total").text("0.00")},register:function(){}},comment:{add:function(){var a=$("#obs-text").val();""==a?alert("Digite uma observa\u00e7\u00e3o!"):($("#obs-list").append('<li><span class="obs-item">'+a+'</span><span class="add-on btn obs-list-btn"><i class="icon-remove"></i></span></li>'),$(".obs-list-btn").unbind("click").click(function(){$(this).parent().remove()}))},clearText:function(){$("#obs-text").val("")},clear:function(){$("#obs-list").empty()},
clearAll:function(){this.clear();this.clearText()},getAll:function(){for(var a=$(".obs-item"),b="",c=0;c<a.length;++c)b+=$(a[c]).text()+";";return b},register:function(){$("#btn-add-obs").unbind().click(this.add);$("#btn-rem-obs").unbind().click(this.clearText.bind(this))}},lock:function(){display($("#pedido-dado, #loading-box"));display($("#pedido-box"),!1)},unlock:function(){display($("#pedido-dado, #loading-box"),!1);display($("#pedido-box"))},display:function(a){$("#pedido-cliente-nome").text(a.client.nome);
$("#pedido-endereco").text(a.endereco.rua);$("#pedido-endereco-numero").text(a.endereco.numero);$("#pedido-bairro").text(a.endereco.bairro);$("#pedido-cidade").text(a.endereco.cidade);$("#pedido-estado").text(a.endereco.uf);$("#pedido-valor-frete").text(a.frete.valor);$("#pedido-tipo-frete").text(a.frete.nome);$("#pedido-frete-data").text(a.frete.prazo);$("#pedido-subtotal").text(Number(a.subtotal).toFixed(2));$("#pedido-total").text(Number(a.total).toFixed(2));a=a.itens;var b=$(".pedido-produto");
b.find("tr").each(function(){0==$(this).find("th").length&&$(this).remove()});for(var c=0;c<a.length;++c)b.append("<tr><td>"+a[c].id+"</td><td>"+a[c].nome+"</td><td>"+a[c].qtd+"</td><td>"+Number(a[c].vu).toFixed(2)+"</td><td>"+Number(a[c].vt).toFixed(2)+"</td></tr>");display($("#pedido-dado"))},clear:function(){$("#pedido-cliente-nome").text("");$("#pedido-endereco").text("");$("#pedido-endereco-numero").text("");$("#pedido-bairro").text("");$("#pedido-cidade").text("");$("#pedido-estado").text("");
$("#pedido-valor-frete").text("");$("#pedido-tipo-frete").text("");$("#pedido-frete-data").text("");$("#pedido-subtotal").text("");$("#pedido-total").text("");$(".pedido-produto").find("tr").each(function(){0==$(this).find("th").length&&$(this).remove()});display($("#pedido-dado"),!1)},finalize:function(){var a=this.client.get();if(0>=a)alert("Selecione um cliente!");else{var b=this.client.address.get();if(0>=b)alert("Selecione um endere\u00e7o!");else{var c=this.shipping.get();if(null==c||0>c)alert("Selecione o tipo de frete!");
else{var e=this.cart.get();if(0>=e.length)alert("Adicione itens ao carrinho!");else{var f=this.comment.getAll(),a={cid:a,eid:b,valor:this.cart.getSubTotal(),frete:c,obs:f,itens:e},a=JSON.stringify(a);this.lock();request("save_pedido",{data:a},function(a){this.unlock();this.display(a)}.bind(this),this.unlock.bind(this))}}}}},confirmPayment:function(){this.lock();request("pay_pedido",{},function(a){this.unlock();void 0!=a.error?alert(a.error):(alert(a.msg),this.clearAll())}.bind(this),this.unlock.bind(this))},
clearAll:function(){this.client.clear();this.product.clear();this.shipping.clear();this.comment.clearAll();this.cart.clear();this.clear()},register:function(){this.client.register();this.product.register();this.shipping.register();this.comment.register();this.cart.register();$("#btn-pedido-pay").unbind().click(this.confirmPayment.bind(this));$("#btn-pedido-cancel").unbind().click(this.clear.bind(this));$("#finalizar").unbind().click(this.finalize.bind(this))}};order.register();